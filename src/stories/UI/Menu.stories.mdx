import { useRef } from "react";
import { Meta, Canvas, Story, Preview, Props } from "@storybook/addon-docs";
import {
  BasicMenu,
  Dynamic,
  SingleUnControlled,
  MultipleControlled,
} from "./Menu.examples";
import { Menu, Item } from "../../indexLib";
import { ArgsTable } from "@storybook/addon-docs";
import { StoryCenteredInline, StoryCenteredColumn } from "../StoryLayout";

export const BasicMenuStory = (args) => (
  <StoryCenteredInline>
    <BasicMenu {...args} />
  </StoryCenteredInline>
);

<Meta
  title="Selection/Menu"
  argTypes={{
    children: {
      table: {
        disable: true,
      },
    },
    className: {
      table: {
        disable: true,
      },
    },
    autoFocus: {
      table: {
        disable: true,
      },
    },
    items: {
      table: {
        disable: true,
      },
    },
    disabledKeys: {
      table: {
        disable: true,
      },
    },
    expandedKeys: {
      table: {
        disable: true,
      },
    },
    defaultExpandedKeys: {
      table: {
        disable: true,
      },
    },
    onExpandedChange: {
      table: {
        disable: true,
      },
    },
    selectionMode: {
      control: "select",
      options: ["single", "multiple", undefined],
    },
    disallowEmptySelection: {
      table: {
        disable: true,
      },
    },
    selectedKeys: {
      table: {
        disable: true,
      },
    },
    defaultSelectedKeys: {
      table: {
        disable: true,
      },
    },
    onSelectionChange: {
      table: {
        disable: true,
      },
    },
    disabledKeys: {
      table: {
        disable: true,
      },
    },
    onAction: {
      table: {
        disable: true,
      },
    },
    onAction: {
      table: {
        disable: true,
      },
    },
    onClose: {
      table: {
        disable: true,
      },
    },
    id: {
      table: {
        disable: true,
      },
    },
    "aria-label": {
      table: {
        disable: true,
      },
    },
    "aria-labelledby": {
      table: {
        disable: true,
      },
    },
    "aria-describedby": {
      table: {
        disable: true,
      },
    },
    "aria-details": {
      table: {
        disable: true,
      },
    },
    "aria-describedby": {
      table: {
        disable: true,
      },
    },
  }}
  component={Menu}
/>

# Menu

Menus display a list of actions or options on temporary surfaces that a user can choose.

The 'surface' on which the Menu sits is provided by the component consuming the Menu such as [MenuButton](?path=/docs/inputs-menubutton--a-basic-button) which provides the `Popup` as a 'surface'. You can use Menu to build custom components in the same way that MenuButton does.

```ts
import { Menu, Item } from "@actionishope/shelley";

<Menu onAction={(key) => alert(key)}>
  <Item key="publish">Publish</Item>
  <Item key="archive">Archive</Item>
  <Item key="delete">Delete</Item>
</Menu>;
```

<Preview>
  <Story name="a) Menu">{BasicMenuStory.bind({})}</Story>
</Preview>

## Menu props

Menu is built with [useMenu](https://react-spectrum.adobe.com/react-aria/useMenu.html) and [useTreeState](https://react-spectrum.adobe.com/react-stately/useTreeState.html) accepting `AriaMenuOptions` and `TreeProps` respectfully as per the Adobe docs.

<Props of={Menu} />

**Notea:**

- `autoFocus` is set to `"first"` by default
- `aria-label` or `aria-labelledby` required in order to suppress the console warning.

## Dynamic collections

Menu follows the [Collection Components API](https://react-spectrum.adobe.com/react-stately/collections.html), accepting both static and dynamic collections. The examples above show static collections, which can be used when the full list of options is known ahead of time. Dynamic collections, as shown below, can be used when the options come from an external data source such as an API call, or update over time.

As seen below, an iterable list of options is passed to the Menu using the `items` prop. Each item accepts a key prop, which is passed to the onSelectionChange handler to identify the selected item. Alternatively, if the item objects contain an id property, as shown in the example below, then this is used automatically and a key prop is not required.

<Preview>
  <Story name="b) Dynamic collections">
    <StoryCenteredInline>
      <Dynamic />
    </StoryCenteredInline>
  </Story>
</Preview>

## Selection

Menu supports multiple selection modes. By default, selection is disabled, however this can be changed using the selectionMode prop. Use defaultSelectedKeys to provide a default set of selected items (uncontrolled) and selectedKeys to set the selected items (controlled). The value of the selected keys must match the key prop of the items. See the react-stately [Selection docs](https://react-spectrum.adobe.com/react-stately/selection.html#selected-key-data-type) for more details.

<Preview>
  <Story name="c) Single selection">
    <StoryCenteredColumn>
      <SingleUnControlled />
    </StoryCenteredColumn>
  </Story>
</Preview>

Set `selectionMode` prop to `multiple` to allow more than one selection.

<Preview>
  <Story name="d) Multi selection">
    <StoryCenteredColumn>
      <MultipleControlled />
    </StoryCenteredColumn>
  </Story>
</Preview>

## Menu Item

`Item` is mapped to `MenuItem`

@todo: Add some stuff on menu item:

- Internally Item is mapped to the `MenuItem`
- Grid alignment of MenuItem, icon, descriptions etc.
